<% content_for :head do %>
<%= stylesheet_link_tag "manage/map" %>
<%end-%>

<%- content_for :tail do %>
<%= javascript_include_tag "/resources/js/plugins/exp/exp.js" %>
<script>
  // $(".map-next,.map-next-bullet").click(function(){
  //   $obj = $(".map-kv-container ul li.map-active")
  //   _url = $obj.next().find("a").attr("href")
  //   if(_url==undefined){
  //     _url = $(".map-kv-container ul li").eq(0).find("a").attr("href")
  //   }
  //   //window.location.href = _url
  // })
  // $(".map-prev,.map-prev-bullet").click(function(){
  //   $obj = $(".map-kv-container ul li.map-active")
  //   _url = $obj.prev().find("a").attr("href")
  //   if(_url==undefined){
  //     _url = $(".map-kv-container ul li").eq(-1).find("a").attr("href")
  //   }
    //window.location.href = _url
  })
</script>

<script type="text/javascript">

jQuery(function($){
  var bin = $('.map-kv-slider'),
    ul = bin.find('ul'),
    li = ul.find('li'),
    pages = li.length,
    h = li.outerHeight() + 8,
    bigimg = $('.js-map-big').find('img')[0],
    pager = 1;
  var bool = pages >= 4
  if(bool) ul.html(ul.html() + ul.html());

  // prev
  $('.js-map-next,.js-map-next-bullet').click(function(){
    if(bool){
      if(ul.is(':animated'))return
      if(pager <= pages){
        ul.stop(true).animate({'top': '-=' + h});
        pager ++;
      } else {
        ul.stop(true).css('top',0).animate({'top': '-=' + h});
        pager = 2;
      }
    } else {
      if(pager < pages) pager ++
      else pager = 1
    }

    makepager(pager);
  });
  // next
  $('.js-map-prev,.js-map-prev-bullet').click(function(){
    if(bool){
      if(ul.is(':animated'))return
      if(pager > 1){
        ul.stop(true).animate({'top': '+=' + h});
        pager --;
      } else {
        ul.stop(true).css('top',- pages * h).animate({'top': '+=' + h});
        pager = pages;
      }
    } else {
      if(pager > 1) pager --
      else pager = pages
    }
    makepager(pager);
  });

  function makepager(num){
    ul.find('li').eq(num - 1).trigger('click');
  }
  ul.find('li').on('click', function(){
    var that = $(this);
    that.addClass('map-active').siblings('.map-active').removeClass();
    var img = this.getElementsByTagName('img')[1]
    bigimg.src = img.src;

    var index = img.getAttribute('index')
    if(index){
      $('div.colors_box').hide().eq( +index ).show()
      $('div.work_tags').hide().eq( +index ).show()
    }
    // var index = that.index();
    // if(index <= pages){
    //  ul.stop(true).animate({'top' : - index * h})
    //  if(index > pages){
    //    index = 1;
    //  } else {
    //    pager = index + 1;
    //  }
    // }
  });

  var hash = window.location.hash.slice(1)
  if(hash || hash.length){
    $('[data-id=' + hash + ']').parents('li').click()
  }
});
</script>


<%- end %>

<h3 class="chann_caption nomargin">
  <i class="icon-map icon-map1 icon_colors"></i>
  <strong>对话名人</strong>
  <small>不怕不懂，就怕不问！再多家装问题，都有iColor专家为您免费解答！</small>
</h3>
<div class="clearfix">
  <div class="footer_banner pull-left"><a href="<%= @banners[0].url -%>"><img src="<%=@banners[0].file(:list_670x85)%>"></a></div>
  <div class="footer_banner pull-right"><a href="<%= @banners[1].url -%>"><img src="<%=@banners[1].file(:list_310x85)%>"></a></div>
</div>

<ul class="breadcrumb">
  <li><a href="/">首页</a> &gt;</li>
  <li><a href="/dialog_celebrity">对话名人</a> &gt;</li>
  <li><a href="/dialog_celebrity/master_interviews">名家设计</a> &gt;</li>
  <li class="active"><%=@master_design.title -%></li>
</ul>
<hr class="border2 border2_mt2">

<h4><%=@master_design.title -%></h4>
<div class="index_main clearfix">
  <div class="pull-left imgbase_in_left">
    <div class="slides_box clearfix">
      <div class="map-big pull-left js-map-big">
        <% if @upload -%>
          <img src="<%=@upload.file2(:slide)%>" />
        <%end-%>
      </div>
      <div class="map-kv-slider pull-right">
        <a href="javascript:;" class="map-prev-bullet js-map-prev-bullet">prev</a>
        <hr class="nomargin">
        <a href="javascript:;" class="map-prev js-map-prev">上一张图</a>
        <div class="map-kv-container">
          <ul>
            <% @master_design.master_design_uploads.each_with_index do |_upload,index| -%>
            <li class="<%= _upload.id == @upload.id ? 'map-active' : ''%>"><a href="#<%=dialog_celebrity_master_design_path(@master_design.id,upload_id: _upload.id)%>"><span></span><img src="<%=_upload.file2(:thumb2)-%>" alt="<%=_upload.title%>" /><img src="<%=_upload.file2(:slide)-%>" style="display:none;"/></a></li>
            <%end -%>
          </ul>
        </div>
        <a href="javascript:;" class="map-next js-map-next">下一张图</a>
        <hr class="nomargin">
        <a href="javascript:;" class="map-next-bullet js-map-next-bullet mt10">next</a>
      </div>
    </div>
    <div class="btn_group clearfix">
      <a target="_blank" href="<%= master_interview_dialog_celebrity_master_profile_path(@master) -%>" class="btn1 pull-left"><i class="icon-i16 icon-suit"></i>查看该大师访谈</a>
      <a href="<%=fullscreen_master_design_url(@master_design)%>" target="_blank" class="btn2 pull-right"><i class="icon-i16 icon-fullscreen"></i>全屏</a>

      <%= link_to user_collects_path(1, master_design_id: @master_design.id), class: 'btn2 pull-right', :remote => true, method: :post, :title => '' do %>
          <i class='icon-i16 icon-collect'></i>收藏
        <%- end %>

      <a href="<%= @upload.present? ? download_dialog_celebrity_master_design_path(@upload.id) : '#' -%>" class="btn2 pull-right"><i class="icon-i16 icon-freedown"></i>免费下载</a>
      <!-- <a href="#" class="btn2 pull-right"><i class="icon-i16 icon-xin_gray"></i>8799</a> -->
    </div>
    <div class="colors_box clearfix">
      <div class="pull-left"><img src="/assets/imgbase_in/color.jpg"></div>
      <ul class="pull-left unstyled">
        <li>
          <div class="colorblock" style="background-color: <%= @upload.recommend_color1 -%>"></div>
          <h6 class="colortitle">墙面推荐色</h6>
          <p class="colorname"><%= @upload.recommend_color_category1 -%></p>
        </li>
        <li>
          <div class="colorblock" style="background-color: <%= @upload.recommend_color2 -%>"></div>
          <h6 class="colortitle">墙面推荐色</h6>
          <p class="colorname"><%= @upload.recommend_color_category2 -%></p>
        </li>
        <li>
          <div class="colorblock" style="background-color: <%= @upload.recommend_color3 -%>"></div>
          <h6 class="colortitle">墙面推荐色</h6>
          <p class="colorname"><%= @upload.recommend_color_category3 -%></p>
        </li>
      </ul>
      <a href="http://nipponpaint.tmall.com/shop/viewShop.htm?prt=1338961882482&prc=1" class="gobuy pull-right"></a>
      <a href="http://www.nipponpaint.com.cn/web/home/dealer_search.jsp" class="goshop pull-right"></a>
    </div>
    <div style="height:30px;margin-left:20px;margin-top:18px;">
      <!-- Baidu Button BEGIN -->
      <div id="bdshare" class="bdshare_t bds_tools get-codes-bdshare">
        <span class="bds_more">分享到：</span>
        <a class="bds_qzone"></a>
        <a class="bds_tsina"></a>
        <a class="bds_tqq"></a>
        <a class="bds_renren"></a>
        <a class="bds_t163"></a>
        <!-- <a class="shareCount"></a> -->
      </div>
      <script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=0" ></script>
      <script type="text/javascript" id="bdshell_js"></script>
      <script type="text/javascript">
      document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000)
      </script>
      <!-- Baidu Button END -->
    </div>
  </div>
  <div class="pull-right imgbase_in_right works">
    <%= render "dialog_celebrity/shared/media_chann" -%>
    <div class="mt10"><a href="<%= @banners[2].url -%>"><img src="<%=@banners[2].file(:list_230x230)%>"></a></div>
    <%= render "dialog_celebrity/shared/new_designs" -%>
  </div>
</div>

<div class="mt10"><a href="<%= @banners[3].url -%>"><img src="<%=@banners[3].file(:list_1000x85)%>"></a></div>

