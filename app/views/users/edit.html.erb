<% content_for :head do -%>
  <%= stylesheet_link_tag 'uploadify' %>
  <style type="text/css">
    #upload_photo{margin:0 auto;cursor:pointer;}
    #upload_photo object{left:0}
  </style>
<% end -%>

<% content_for :tail do -%>
  <%= javascript_include_tag "/location.js", "jquery.uploadify.js" %>
  <script type="text/javascript" charset="utf-8">
    <%- session_key = Rails.application.config.session_options[:key] -%>
    $(function() {

      $('#upload_photo').click(function(event){
        event.preventDefault();
      });

      $('#upload_photo').uploadify({
        swf : '/uploadify/uploadify.swf',
        cancelImage : '/uploadify/uploadify-cancel.png',
        skipDefault : ['onSelect'],
        buttonText : "修改头像",
        // width : 184,
        // height : 46,
        multi : false,
        auto : true,
        checkExisting : false,
        transparent : true,
        uploader : '<%= user_avatar_path(current_user) %>',
        onUploadSuccess : function(file, data, response) {
          var dat = eval('(' + data + ')');
          $.getScript(dat.upload);
        },
        postData : {
            '_http_accept': 'application/javascript',
            'format' : 'json',
            '_method': 'post',
            '<%= session_key %>' : '<%= cookies[session_key] %>',
            'authenticity_token': '<%= form_authenticity_token %>'
        },
        onUploadStart : function(){
          $("#upload_going").show();
        },
        onUploadComplete : function(){
          $("#upload_going").hide();
        }
      });
    });
  </script>
<% end %>



<div class="container">
  <ul class="breadcrumb">
    <li><a href="#">首页</a> > </li>
    <li class="active">用户中心</li>
  </ul>
  <hr class="border2 border2_mt2">

  <ul class="nav nav-tabs upload_tab login_tab" id="login_tab">
    <li><a href="/users/sign_in">登录</a></li>
    <li class="active"><a href="/users/sign_up">注册</a></li>
    <li><a href="/users/password/new">找回密码</a></li>
  </ul>

  <div class="tab-content login_content">
    <div class="tab-pane active" id="login_tab2">
      <div class="index_main noborder">
        <!-- <form class=""> -->
        <%= form_for current_user, :url => user_path, :remote => true, html: {class: "form-horizontal reg_form"}  do |f| %>
          <% if params[:edit_by].present? %>
            <%= hidden_field_tag "user[edit_by]", params[:edit_by] %>
          <% end %>
          <ul class="unstyled clearfix steps step3">
            <li class="muted" style="width:163px;"><small>Step 1 基本资料</small></li>
            <li class="muted" style="width:559px;"><small>Step 2 注册成功</small></li>
            <li class="muted" style="width:163px;"><small>Step 3 完善信息</small></li>
          </ul>
          <%#= render :partial => "#{current_user.role.role rescue 'user'}" ,:locals => { :f => f } %>
          <div class="clearfix pb25">
            <div class="pull-left reg_form_left mr10">
              <div class="control-group">
                <label class="control-label smaller" for="">
                  真实姓名
                </label>
                <div class="controls smaller">
                  <%= f.text_field :name, :class => "input-large" %>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label smaller" for="">
                  性别
                </label>
                <div class="controls smaller">
                  <label class="radio inline">
                    <input type="radio" <%= "checked" if current_user.sex == "1" %> name="user[sex]" value="1"/>
                    <small>男</small>
                  </label>
                  <label class="radio inline">
                    <input type="radio" class="radio_btn fl" <%= "checked" if current_user.sex == "0" %> name="user[sex]" value="0"/>
                    <small>女</small>
                  </label>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label smaller" for="">
                  生日
                </label>
                <% year  = resource.date_of_birth.year rescue nil %>
                <% month = resource.date_of_birth.month rescue nil %>
                <% day   = resource.date_of_birth.day rescue nil %>
                <div class="controls smaller">
                  <%= select_tag 'user[date_of_birth(1i)]', options_for_select((1900..(Date.today.year)).to_a.reverse, year), :class => "input-small", :prompt => current_user.date_of_birth? ? current_user.date_of_birth.try(:year) : "年" %>
                  <%= select_tag 'user[date_of_birth(2i)]', options_for_select((1..12).to_a, month), :class => "input-small", :prompt => current_user.date_of_birth? ? current_user.date_of_birth.try(:month) : "月" %>
                  <%= select_tag 'user[date_of_birth(3i)]', options_for_select((1..31).to_a, day), :class => "input-small", :prompt => current_user.date_of_birth? ? current_user.date_of_birth.try(:day) : "日" %>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label smaller" for="">
                  公司名称
                </label>
                <div class="controls smaller">
                  <%= f.text_field :inauguration_company, :class => "input-xlarge" %>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label smaller" for="">
                  收件地址
                </label>
                <div class="controls smaller">
                  <%= f.text_field :recipient_address, :class => "input-xlarge mr5" %>
                  <span class="label label-blue">请填写真实地址以便发送奖品</span>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label smaller" for="">
                  邮编
                </label>
                <div class="controls smaller">
                  <%= f.text_field :zip_code, :class => "input-large mr5" ,:maxlength => "6" %>
                  <span class="label label-blue">邮编必须为数字且只能6位</span>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label smaller" for="">
                  在线联系方式
                </label>
                <div class="controls smaller">
                  <img src="<%= asset_path "news/qq_icon.jpg" %>" />
                  <%= f.text_field :qq, :class => "input-small" %>
                  <img src="<%= asset_path "news/weixin.png" %>" />
                  <%= f.text_field :fetion, :class => "input-small" %>
                </div>
              </div>
            </div>
            <div class="pull-left reg_form_right" >
              <div id="upload_area">
                <% if current_user.avatar -%>
                  <%= render(:partial => "avatars/upload", :locals => {:upload => current_user.avatar}) %>
                <% else -%>
                  <img  src="<%= asset_path "news/user_photo.png" %>" class="user_photo" />
                <% end %>
              </div>
              <div class="mt20 text-center">
                <a class="btn btn-inverse user_photo_btn" id="upload_photo" href="#">修改头像</a>
              </div>
            </div>
          </div>
          <div class="text-center dott1 pt30 mt20">
            <button type="submit" class="upload_img_btn">保存</button>
            <a href="/" class="upload_img_btn">跳过</a>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="clearfix">
    <div class="footer_banner mt10 pull-left">
      <a href="<%= @banners[1].url? ? @banners[1].url : 'javascript:void(0);' if @banners[1] %>" target="_blank">
        <%= image_tag @banners[1].try(:file).try(:url, :list_670x85) if @banners[1] %>
      </a>
    </div>
    <div class="footer_banner mt10 pull-right">
      <a href="<%= @banners[2].url? ? @banners[2].url : 'javascript:void(0);' if @banners[2] %>" target="_blank">
        <%= image_tag @banners[2].try(:file).try(:url, :list_310x85) if @banners[2] %>
      </a>
    </div>
  </div>
</div>