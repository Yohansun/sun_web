<% content_for :tail do -%>
<script type="text/javascript">
  $(function(){

    $('#upload_image form[data-redirect_url]').bind('ajax:success', function(evt, data) {
      alert("保存成功");

      if ($.trim(window.flag).length == 0) {
        // var i_id = <%= @index_id %>;
        // if ($.trim(i_id).length == 0) {
          var url = "/manage/home_design_show?design_type=<%= @design_type_next %>"
          window.location.href = url;
        // } else {
        //   var next_id = i_id + 1
        //   if (next_id > 4) {
        //     next_id = 1
        //   }
        //   $('.link' + next_id).click();
        // }
      } else {
        var url = $(this).data('redirect_url');
        window.location.href = url;
      }
    }).bind("ajax:error", function(evt, data) {
      alert(data.responseText);
    });

    $('#get_vote').on('click', function(event) {
      var url = $('#url').val();
      $.post("home_image_lib/search_vote",{url: url},function(result){
        $('#vote').val(result);
      });
    });

  });

  function open_link() {
    var url = $('#url').val();
    window.open(url, "_blank");
  }

  function btn_save() {
    window.flag = 1;
  }
</script>
<% end %>
<% content_for :head do -%>
<style>
#upload_image {
  /*width: 900px;*/
}
.design_form .control-label{width:auto;}
.form_edit{margin-top:20px;}
.editarea{width:500px;}
.editarea .media{border-bottom:1px dotted #ddd;padding-bottom:20px;}
.editarea .media:last-child{border:0;}
/*.editarea img{width:150px;height:80px;}*/
.showarea{width:300px;height:270px;}
.showarea a{margin:0 8px 8px 0;border:1px solid #ddd;position:relative;}
.showarea a span{position:absolute;width:100%;height:100%;text-align:center;z-index:-1}
.showarea a.img_big span{line-height:260px;}
.showarea a.img_small span{line-height:80px;}
.showarea .img_big,.showarea .img_big img{width:200px;height:260px;}
.showarea .img_small,.showarea .img_small img{width:80px;height:80px;}
</style>
<% end %>
<div id="upload_image">
<%= form_tag('home_design_show/save_data', :id => 'edit_form', :remote => true, :'data-redirect_url' => "/manage/home_design_show?design_type=#{@design_type}") do %>
<%= hidden_field_tag 'design_id', @home_design_show.id %>
<!-- <h5>编辑信息</h5> -->
<div class="clearfix form-inline">
  <label for="" class="control-label">标题</label>
  <input type="text" id="title" name="title" class="input-xlarge" value="<%= @title %>" data-maxlength=11 maxlength=11 />
  <span class="help-inline text-error">标题最多输入11个汉字</span>
</div>
<div class="clearfix form_edit">
  <div class="editarea">
    <div class="media">
      <!-- <a class="pull-left" href="#">
        <img src="<%= @home_design_show.file.url(:list_80x80) %>" alt="">
      </a> -->
      <div class="media-body">
        <p class="form-inline">
          <label for="" class="control-label">位置</label>
          <select name='position' class='input-small'>
            <option value=1 <%= "selected" if @home_design_show.position == 1 %>>左1</option>
            <option value=2 <%= "selected" if @home_design_show.position == 2 %>>右1</option>
            <option value=3 <%= "selected" if @home_design_show.position == 3 %>>右2</option>
            <option value=4 <%= "selected" if @home_design_show.position == 4 %>>右3</option>
          </select>
          <label class="control-label">投票数</label>
          <!-- <div class="controls"> -->
          	<input type="text" id="vote" name="vote" class="input-mini" value="<%= @home_design_show.vote %>">
          	<%= link_to "获取投票数", "javascript:void(0);", :id => "get_vote", :class => 'btn btn-link' %>
          <!-- </div> -->
        </p>
        <p class="form-inline">
          <label for="" class="control-label">链接</label>
          <input type="text" id="url" name="url" class="input-xlarge" value="<%= @home_design_show.url %>">
          <a href="javascript:;" class="help-inline btn btn-link" onclick="open_link();return false;">检测链接</a>
        </p>
        <p class="form-inline">
        	<%= submit_tag "保存", :id => 'save', :onclick => "return btn_save();", data: { disable_with: "请等待..." }, :class => 'btn btn-small btn-primary' %>
        	<%= submit_tag "保存并跳转到下一栏", :id => 'next_save', data: { disable_with: "请等待..." }, :class => 'btn btn-small btn-primary' %>
        </p>
      </div>
    </div>
    <!-- <div class="media">
    </div>
    <div class="media">
    </div> -->
  </div>
  <div class="showarea">
    <a class="pull-left img_big" href="javascript:;">
      <span>左一 200x260</span>
      <!-- <img src="images/gallery/image-2.jpg" alt=""> -->
    </a>
    <a class="pull-left img_small" href="javascript:;">
      <span>右一 80x80</span>
      <!-- <img src="images/gallery/thumb-5.jpg" alt=""> -->
    </a>
    <a class="pull-left img_small" href="javascript:;">
      <span>右二 80x80</span>
      <!-- <img src="images/gallery/thumb-2.jpg" alt=""> -->
    </a>
    <a class="pull-left img_small" href="javascript:;">
      <span>右三 80x80</span>
      <!-- <img src="images/gallery/thumb-1.jpg" alt=""> -->
    </a>
  </div>
</div>
<% end %>
</div>


