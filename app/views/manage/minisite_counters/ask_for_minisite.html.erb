<div class="main bs-docs-grid">
  <h2>"业主受邀" 报表</h2>
  <div class="row show-grid">
    <div class="span10">
      <%= form_tag('/manage/minisite_counters/ask_for_minisite', :class => 'form-inline', :method => 'get') do %>
        日期:从
        <%= text_field_tag "data_start", params[:data_start].present? ? params[:data_start] : '2014-01-01 00:00:00', :class => "input-medium datetimepicker_full", :name => 'data_start', :readonly => 'readonly' %>
        到
        <%= text_field_tag "data_end", params[:data_end].present? ? params[:data_end] : Time.now.to_s, :class => "input-medium datetimepicker_full", :name => 'data_end', :readonly => 'readonly' %>
        &nbsp;&nbsp;&nbsp;
        <%= button_tag "查询", data: { disable_with: "请等待..." }, :class => 'btn btn-small btn-primary' %>
        &nbsp;&nbsp;
        <a href="<%= ask_for_minisite_minisite_counters_path(:format => :xls) %>" class="btn btn-small btn-primary">Excel报表</a>
      <% end %>
    </div>
  </div>
</div>

<div class="main bs-docs-grid">
  <div class="row show-grid">
    <div class="span12">
      <table class="table table-striped table-bordered table-hover">
        <thead>
          <tr>
            <td>点击邀约设计时间</td>
            <td>业主用户名</td>
            <td>省</td>
            <td>市</td>
            <td>区</td>
            <td>电话</td>
            <td>邮箱</td>
            <td>邀约留言内容</td>
            <td>被邀约的设计师/家装公司用户名</td>
            <td>设计师/家装公司电话</td>
            <td>设计师/家装公司邮箱</td>
          </tr>
        </thead>
        <tbody>
          <% @asks.each do |ask| %>
            <% ask_user = ask.reply_user %>
            <tr>
              <td><%= ask.created_at %></td>
              <td><%= ask.reply_user.try(:display_name) %></td>
              <% if ask_user && ask_user.area_id.present? %>
                <% area = Area.find_by_id(ask_user.area_id) %>
                <td><%= area.province.name if area %></td>
                <td><%= area.city_name if area %></td>
                <td><%= area.district.name if area %></td>
              <% else %>
                <% 3.times do %>
                  <td></td>
                <% end %>
              <% end %>
              <td><%= ask_user.try(:phone) if ask_user %></td>
              <td><%= ask_user.try(:email) if ask_user %></td>
              <td><%= truncate(ask.content, length: 10) %></td>
              <td><%= ask.user.try(:display_name) %></td>
              <td><%= ask.user.try(:phone) %></td>
              <td><%= ask.user.try(:email) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
  <div class="navbar-form pull-left">
    <div class="span4">
      <%= paginate @asks, :outer_window => 5 %>
    </div>
  </div>
</div>