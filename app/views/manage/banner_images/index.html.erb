<%= stylesheet_link_tag "upload_image/jquery.fileupload-ui" %>
<script type="text/javascript">
  $(function(){
  	$('#home_link1').click(function(){
				window.open($('#home-url-1').val());
			});
    $('form[data-redirect_url]').bind('ajax:success', function(evt, data) {
      alert("保存成功");

      var url = $(this).data('redirect_url');
      window.location.href = url;
    }).bind("ajax:error", function(evt, data) {
      alert(data.responseText);
    });

  });
</script>
<div id="breadcrumbs">
  <ul class="breadcrumb">
    <li class="<%= 'active_red' if params[:page_name] == '图库首页' %>"><a href="<%= banner_images_path(page_name: '图库首页') %>">图库首页</a></li>
    <span>|</span>
    <li class="<%= 'active_red' if params[:page_name] == '图库列表页' %>"><a href="<%= banner_images_path(page_name: '图库列表页') %>">图库列表页</a></li>
  	<span>|</span>
  	<li class="<%= 'active_red' if params[:page_name] == '图库内页' %>"><a href="<%= banner_images_path(page_name: '图库内页') %>">图库内页</a></li>
  	<span>|</span>
  	<li class="<%= 'active_red' if params[:page_name] == '图库专题导购' %>"><a href="#">图库专题导购</a></li>
  </ul>
</div>
<div class="main">
	<div id="index_tab6" class="tab-pane active">
		<div class="clearfix row-fluid bann_edit">
			<!-- used base_helper refresh_label_path -->
			<%= render :partial => images_label_path, locals: { i_banner: @i_banner } %>

			<div class="span8">
				<p class="banner_show">
					<img src="<%= asset_path @i_banner.file("list_#{@i_banner.size}".to_sym) %>">
				</p>
				<div>
				<span class="btn btn-small btn-primary fileinput-button">
				    <i class="icon-plus icon-white"></i>
				    <span>上传图片...</span>
				    <input id="fileupload" type="file" name="file" multiple>
				</span>
				<span class="help-inline">当前banner限制尺寸：<%= @i_banner.size %></span></div>
				<div class="widget-box mt5">
					<div class="widget-header widget-header-flat">
						<h5>编辑信息</h5>
					</div>
					<div class="widget-body">
						<%= form_tag('banner_images/save_data', :id => 'edit_form', :remote => true, :'data-redirect_url' => "/manage/banner_images?position=#{@i_banner.position}&page_name=#{@i_banner.page_name}", :class => "widget-main clearfix nom") do %>
						<%= hidden_field_tag 'position', @i_banner.position %>
						<%= hidden_field_tag 'page_name', @i_banner.page_name %>
							<div class="span4 form-inline">
								<label class="span3 control-label">图片标识</label>
								<div class="span9">
									<input class="input-medium" type="text" name="photo_name" placeholder="" value="<%= @i_banner.photo_name %>" data-maxlength=10 maxlength=10 />
									<p class="nom">(不超过十个汉字)</p>
								</div>
							</div>
							<div class="span4 form-inline">
								<label class="span1 control-label">组</label>
								<div class="span9">
								<%= select_tag "i_banner_group_id", options_from_collection_for_select(@i_banner_groups, "id", "name", @i_banner.i_banner_group_id), :class => "input-medium" %>
									<p class="nom">当前组共有<strong class="text-error"><%= @i_banner_groups_count %></strong></p>
									<p class="nom"><a href="#">查看所有banner</a></p>
								</div>
							</div>

							<div class="span4 form-inline">
								<label class="span3 control-label">链接</label>
								<div class="span9">
									<input class="input-medium" id="home-url-1" type="text" name="url" value="<%= @i_banner.url %>" />
									<p class="nom"><a href="javascript:void(0);" id="home_link1">检测链接</a></p>
								</div>
							</div>

							<div class="span4 form-inline">
								<p class="span12 nom">页面标识&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%= @i_banner.page_name %></p>
							</div>
							<p class="span12 nom">
								<%= submit_tag "保存", :id => 'save', data: { disable_with: "请等待..." }, :class => 'btn btn-small btn-primary' %>
							</p>
						<% end %>
					</div>
				</div>
			</div>

		</div>
	</div>

</div>
<%= javascript_include_tag "upload_image/vendor/jquery.ui.widget",
                              "upload_image/jquery.iframe-transport",
                              "upload_image/jquery.fileupload" %>
<script type="text/javascript">
$(function() {
    var url = 'banner_images/create_image?position=<%= @i_banner.position %>&page_name=<%= @i_banner.page_name%>';
    $('#fileupload').fileupload({
        url: url,
        dataType: 'json',
        acceptFileTypes:  /(\.|\/)(gif|jpe?g|png)$/i,
        maxNumberOfFiles: 1,
        maxFileSize: 5000000,
        done: function (e, data) {
        	alert(data.result.notify);
        	window.location.href = "/manage/banner_images?position=<%= @i_banner.position %>&page_name=<%= @i_banner.page_name %>";
        },
        error: function (e, data) {
        	alert(data.result);
        }
    })
});
</script>