/*
* myFocus JavaScript Library v1.2.4
* Open source under the BSD & GPL License.
* 
* @Author  koen_lee@qq.com
* @Blog    http://hi.baidu.com/koen_li/
* 
* @Date    2011/07/20
*/
(function(){var mF={defConfig:{pattern:"mF_fscreen_tb",trigger:"click",txtHeight:"default",wrap:!0,auto:!0,time:4,index:0,waiting:20,delay:100,css:!0,path:"/pattern/",autoZoom:!1},pattern:{},extend:function(){var e=arguments,t=e.length,n=1,r=e[0];t===1&&(n=0,r=this.pattern);for(n;n<t;n++)for(var i in e[n])i in r||(r[i]=e[n][i])}},DOM={$:function(e){return typeof e=="string"?document.getElementById(e):e},$$:function(e,t){return(this.$(t)||document).getElementsByTagName(e)},$$_:function(e,t){var n=[],r=this.$$(e,t);for(var i=0;i<r.length;i++)r[i].parentNode===t&&n.push(r[i]),i+=this.$$(e,r[i]).length;return n},$c:function(e,t){var n=this.$$("*",t),e=e.replace(/\-/g,"\\-"),r=new RegExp("(^|\\s)"+e+"(\\s|$)"),i=[];for(var s=0,o=n.length;s<o;s++)if(r.test(n[s].className)){i.push(n[s]);break}return i[0]},$li:function(e,t){return this.$$_("li",this.$c(e,t))},wrap:function(e,t){var n=document.createElement("div");n.className=t,e[0].parentNode.insertBefore(n,e[0]);for(var r=0;r<e.length;r++)n.appendChild(e[r])},wrapIn:function(e,t){e.innerHTML="<ul class="+t+">"+e.innerHTML+"</ul>"},addList:function(e,t){var n=[],r=this.$$("ul",e)[0],i=this.$$_("li",r),s,o=i.length,u=t.length;for(var a=0;a<u;a++){n.push("<ul class="+t[a]+">");for(var f=0;f<o;f++)s=this.$$("img",i[f])[0],n.push("<li>"+(t[a]=="num"?"<a>"+(f+1)+"</a>":t[a]=="txt"&&s?i[f].innerHTML.replace(/\<img(.|\n|\r)*?\>/i,s.alt)+"<p>"+s.getAttribute("text")+"</p>":t[a]=="thumb"&&s?"<img src="+(s.getAttribute("thumb")||s.src)+" />":"")+"<span></span></li>");n.push("</ul>")}e.innerHTML+=n.join("")}},CSS={style:function(e,t){var n=(this.isIE?e.currentStyle:getComputedStyle(e,""))[t],r=parseFloat(n);return isNaN(r)?n:r},setOpa:function(e,t){e.style.filter="alpha(opacity="+t+")",e.style.opacity=t/100},removeClass:function(o,name){var cla=o.className,reg="/\\s*"+name+"\\b/g";o.className=cla?cla.replace(eval(reg),""):""}},Anim={animate:function(e,t,n,r,i,s){var o=t==="opacity",u=this,a=u.setOpa,f=typeof n=="string",l=(new Date).getTime();o&&u.style(e,"display")==="none"&&(e.style.display="block",a(e,0));var c=u.style(e,t),h=isNaN(c)?1:c,p=f?n/1:n-h,d=r||800,v=u.easing[i||"easeOut"],m=p>0?"ceil":"floor";return e[t+"Timer"]&&clearInterval(e[t+"Timer"]),e[t+"Timer"]=setInterval(function(){var r=(new Date).getTime()-l;r<d?o?a(e,Math[m](v(r,h*100,p*100,d))):e.style[t]=Math[m](v(r,h,p,d))+"px":(clearInterval(e[t+"Timer"]),o?a(e,(p+h)*100):e.style[t]=p+h+"px",o&&n===0&&(e.style.display="none"),s&&s.call(e))},13),u},fadeIn:function(e,t,n){return this.animate(e,"opacity",1,t==undefined?400:t,"linear",n),this},fadeOut:function(e,t,n){return this.animate(e,"opacity",0,t==undefined?400:t,"linear",n),this},slide:function(e,t,n,r,i){for(var s in t)this.animate(e,s,t[s],n,r,i);return this},stop:function(e){for(var t in e)t.indexOf("Timer")!==-1&&clearInterval(e[t]);return this},easing:{linear:function(e,t,n,r){return n*e/r+t},swing:function(e,t,n,r){return-n/2*(Math.cos(Math.PI*e/r)-1)+t},easeIn:function(e,t,n,r){return n*(e/=r)*e*e*e+t},easeOut:function(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t},easeInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t}}},Init={set:function(e,t,n){function s(){i==2&&(e.autoZoom&&r.fixIMG(e.id,e.width,e.height),r.pattern[e.pattern].call(r,e,r),n&&n())}function o(){var t=r.$(e.id);t.style.height="314px",r.loadPattern(e.pattern,e.path,function(){r.extend(e,r.pattern[e.pattern].cfg,r.defConfig),e.width=e.width||r.style(t,"width"),e.height=e.height||r.style(t,"height"),r.initCSS(e),t.className+=" "+e.pattern+" "+e.S,t.style.height="",i+=1,s()}),r.onloadIMG(t,e.waiting==undefined?r.defConfig.waiting:e.waiting,function(){i+=1,s()})}typeof t!="boolean"&&(n=t,t=!1);var r=this,i=0;e.pattern=e.pattern||r.defConfig.pattern,e.path=e.path==undefined?r.defConfig.path:e.path,e.S=e.pattern+"-"+e.id;if(t){o();return}window.attachEvent?function(){try{o()}catch(e){setTimeout(arguments.callee,0)}}():r.addEvent(document,"DOMContentLoaded",o)},initCSS:function(e){var t=[],n=e.width,r=e.height,i=document.createElement("style");i.type="text/css",e.wrap&&this.wrap([this.$(e.id)],e.pattern+"_wrap"),e.css&&t.push("."+e.S+" *{margin:0;padding:0;border:0;list-style:none;}."+e.S+"{position:relative;width:"+n+"px;height:"+r+"px;overflow:hidden;font:12px/1.5 Verdana;text-align:left;background:#fff;visibility:visible!important;}."+e.S+" .loading{position:absolute;z-index:9999;width:100%;height:100%;color:#666;text-align:center;padding-top:"+.3*r+"px;background:#fff url(http://www.cosmissy.com/myfocus/img/loading.gif) center "+.4*r+"px no-repeat;}."+e.S+" .pic{position:relative;width:"+n+"px;height:"+r+"px;overflow:hidden;}."+e.S+" .txt li,."+e.S+" .txt li span,."+e.S+" .txt-bg{width:"+n+"px;height:"+e.txtHeight+"px!important;line-height:"+e.txtHeight+"px!important;overflow:hidden;}."+e.S+" .txt li p a{display:inline;}"),e.css&&e.autoZoom&&t.push("."+e.S+" .pic li{text-align:center;width:"+n+"px;height:"+r+"px;}"),i.styleSheet?i.styleSheet.cssText=t.join(""):i.innerHTML=t.join("");var s=this.$$("head",document)[0];s.insertBefore(i,s.firstChild)}},Method={isIE:!+[1],switchMF:function(e,t,n,r,i){return"var _F=this,_ld=_F.$c('loading',box),less="+n+",_tn,first=true,_dir="+r+"||'left',_dis=_dir=='left'||_dir=='right'?par.width:par.height,_wp=less&&("+i+"||pics),index=par.index,_t=par.time*1000;if(less){_wp.style[_dir]=-_dis*n+'px';index+=n;}if(_ld)box.removeChild(_ld);var run=function(idx){("+e+")();var prev=index;if(less&&index==2*n-1&&_tn!=1){_wp.style[_dir]=-(n-1)*_dis+'px';index=n-1}if(less&&index==0&&_tn!=2){_wp.style[_dir]=-n*_dis+'px';index=n}if(!less&&index==n-1&&idx==undefined)index=-1;if(less&&idx!==undefined&&index>n-1&&!_tn&&!first) idx+=n;var next=idx!==undefined?idx:index+1;if("+t+")("+t+")();index=next;_tn=first=null;};run(index);if(_t&&par.auto)var auto=setInterval(function(){run()},_t);_F.addEvent(box,'mouseover',function(){if(auto)clearInterval(auto)});_F.addEvent(box,'mouseout',function(){if(auto)auto=setInterval(function(){run()},_t)});for(var i=0,_lk=_F.$$('a',box),_ln=_lk.length;i<_ln;i++) _lk[i].onfocus=function(){this.blur();}"},bind:function(e,t,n){return"for (var j=0;j<n;j++){"+e+"[j].index=j;if("+t+"=='click'){"+e+"[j].onmouseover=function(){if(this.index!=index)this.className+=' hover'};"+e+"[j].onmouseout=function(){_F.removeClass(this,'hover')};"+e+"[j].onclick=function(){if(this.index!=index) {run(this.index);return false}};}else if("+t+"=='mouseover'){"+e+"[j].onmouseover=function(){var self=this;if("+n+"==0){if(self.index!=index){run(self.index);return false}}else "+e+".d=setTimeout(function(){if(self.index!=index) {run(self.index);return false}},"+n+")};"+e+"[j].onmouseout=function(){clearTimeout("+e+".d)};}else{alert('Error Setting : \"'+"+t+"+'\"');break;}}"},toggle:function(e,t,n){return"var _stop=false;"+e+".onclick=function(){this.className=this.className=='"+t+"'?'"+n+"':'"+t+"';if(!_stop){clearInterval(auto);auto=null;_stop=true;}else{auto=true;_stop=false;}}"},scroll:function(e,t,n,r,i){return"var scPar={},scDis="+n+",scN=Math.floor("+r+"/2),scDir=parseInt("+e+".style["+t+"])||0,scIdx=next>=n?next-n:next,scDur="+i+"||500,scMax=scDis*(n-"+r+"),scD=scDis*scIdx+scDir;if(scD>scDis*scN&&scIdx!==n-1) scPar["+t+"]='-'+scDis;if(scD<scDis&&scIdx!==0) scPar["+t+"]='+'+scDis;if(scIdx===n-1) scPar["+t+"]=-scMax;if(scIdx===0) scPar["+t+"]=0;_F.slide("+e+",scPar,scDur);"},turn:function(e,t){return e+".onclick=function(){_tn=1;run(index>0?index-1:n-1);};"+t+".onclick=function(){_tn=2;var tIdx=index>=2*n-1?n-1:index;run(index==n-1&&!less?0:tIdx+1);}"},alterSRC:function(o,name,del){var img=this.$$("img",o)[0];img.src=del?img.src.replace(eval("/"+name+"\\.(?=[^\\.]+$)/g"),"."):img.src.replace(/\.(?=[^\.]+$)/g,name+".")},onloadIMG:function(e,t,n){var r=this.$$("img",e),i=r.length,s=0,o=!1;for(var u=0;u<i;u++)r[u].onload=function(){s+=1,s==i&&!o&&(o=!0,n())},this.isIE&&(r[u].src=r[u].src);if(t===!0)return;var a=t===!1?0:t*1e3;setTimeout(function(){o||(o=!0,n())},a)},fixIMG:function(e,t,n){var r=this.$$("img",e),i=r.length,s=new Image;for(var o=0;o<i;o++)s.src=r[o].src,s.width/s.height>=t/n?(r[o].style.width=t+"px",r[o].style.marginTop=(n-t/s.width*s.height)/2+"px"):r[o].style.height=n+"px"},loadPattern:function(e,t,n){if(!t){n();return}var r=document.createElement("script"),i=document.createElement("link"),s=t+e+".js",o=t+e+".css";r.type="text/javascript",r.src=s,i.rel="stylesheet",i.href=o,this.$$("head")[0].appendChild(i),this.$$("head")[0].appendChild(r),this.isIE?r.onreadystatechange=function(){(r.readyState=="loaded"||r.readyState=="complete")&&n()}:r.onload=function(){n()},r.onerror=function(){alert("Not Found (404): "+s)}},addEvent:function(e,t,n){var r=this.isIE,i=r?"attachEvent":"addEventListener",s=(r?"on":"")+t;e[i](s,n,!1)}};mF.extend(mF,DOM,CSS,Anim,Init,Method),mF.set.params=function(e,t){mF.pattern[e].cfg=t},myFocus__AGENT__=mF,typeof myFocus=="undefined"&&(myFocus=myFocus__AGENT__),typeof jQuery!="undefined"&&jQuery.fn.extend({myFocus:function(e,t){e||(e={}),e.id=this[0].id,e.id||(e.id=this[0].id="mF__NAME__"),myFocus__AGENT__.set(e,!0,t)}})})();