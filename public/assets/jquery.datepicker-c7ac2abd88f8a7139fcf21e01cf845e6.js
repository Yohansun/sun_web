(function($){if(!dateFormat||typeof dateFormat!="function")var dateFormat=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),w:"0123456".indexOf(this.getDay()),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)(new RegExp("("+n+")")).test(e)&&(e=e.replace(RegExp.$1,RegExp.$1.length==1?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e};if(!DateAdd||typeof DateDiff!="function")var DateAdd=function(interval,number,idate){number=parseInt(number);var date;typeof idate=="string"&&(date=idate.split(/\D/),eval("var date = new Date("+date.join(",")+")")),typeof idate=="object"&&(date=new Date(idate.toString()));switch(interval){case"y":date.setFullYear(date.getFullYear()+number);break;case"m":date.setMonth(date.getMonth()+number);break;case"d":date.setDate(date.getDate()+number);break;case"w":date.setDate(date.getDate()+7*number);break;case"h":date.setHours(date.getHours()+number);break;case"n":date.setMinutes(date.getMinutes()+number);break;case"s":date.setSeconds(date.getSeconds()+number);break;case"l":date.setMilliseconds(date.getMilliseconds()+number)}return date};if(!DateDiff||typeof DateDiff!="function")var DateDiff=function(e,t,n){switch(e){case"d":case"w":t=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n=new Date(n.getFullYear(),n.getMonth(),n.getDate());break;case"h":t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()),n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours());break;case"n":t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()),n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes());break;case"s":t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()),n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds())}var r=t.getTime(),i=n.getTime(),s=NaN;switch(e){case"y":s=n.getFullYear()-t.getFullYear();break;case"m":s=(n.getFullYear()-t.getFullYear())*12+n.getMonth()-t.getMonth();break;case"d":s=Math.floor(i/864e5)-Math.floor(r/864e5);break;case"w":s=Math.floor((i+3456e5)/6048e5)-Math.floor((r+3456e5)/6048e5);break;case"h":s=Math.floor(i/36e5)-Math.floor(r/36e5);break;case"n":s=Math.floor(i/6e4)-Math.floor(r/6e4);break;case"s":s=Math.floor(i/1e3)-Math.floor(r/1e3);break;case"l":s=i-r}return s};var userAgent=window.navigator.userAgent.toLowerCase();$.browser.msie8=$.browser.msie&&/msie 8\.0/i.test(userAgent),$.browser.msie7=$.browser.msie&&/msie 7\.0/i.test(userAgent),$.browser.msie6=!$.browser.msie8&&!$.browser.msie7&&$.browser.msie&&/msie 6\.0/i.test(userAgent),$.fn.noSelect==undefined&&($.fn.noSelect=function(e){return e==null?prevent=!0:prevent=e,prevent?this.each(function(){$.browser.msie||$.browser.safari?$(this).bind("selectstart",function(){return!1}):$.browser.mozilla?($(this).css("MozUserSelect","none"),$("body").trigger("focus")):$.browser.opera?$(this).bind("mousedown",function(){return!1}):$(this).attr("unselectable","on")}):this.each(function(){$.browser.msie||$.browser.safari?$(this).unbind("selectstart"):$.browser.mozilla?$(this).css("MozUserSelect","inherit"):$.browser.opera?$(this).unbind("mousedown"):$(this).removeAttr("unselectable","on")})}),$.fn.datepicker=function(e){function u(){$("#BBIT-DP-TODAY").click(S),n.click(y),$("#BBIT_DP_INNER tbody").click(g),$("#BBIT_DP_LEFTBTN").click(w),$("#BBIT_DP_RIGHTBTN").click(E),$("#BBIT_DP_YMBTN").click(v),$("#BBIT-DP-MP").click(d).dblclick(p),$("#BBIT-DP-MP-PREV").click(l),$("#BBIT-DP-MP-NEXT").click(c),$("#BBIT-DP-MP-OKBTN").click(f),$("#BBIT-DP-MP-CANCELBTN").click(a)}function a(){return $("#BBIT-DP-MP").animate({top:-193},{duration:200,complete:function(){$("#BBIT-DP-MP").hide()}}),!1}function f(){return t.Year=t.cy,t.Month=t.cm+1,t.Day=1,$("#BBIT-DP-MP").animate({top:-193},{duration:200,complete:function(){$("#BBIT-DP-MP").hide()}}),T(),!1}function l(){var e=t.ty-10;return t.ty=e,h(e),!1}function c(){var e=t.ty+10;return t.ty=e,h(e),!1}function h(e){var n=e-4,r=[];for(var i=0;i<5;i++)r.push(n+i),r.push(n+i+5);$("#BBIT-DP-MP td.bbit-dp-mp-year").each(function(e){t.Year==r[e]?$(this).addClass("bbit-dp-mp-sel"):$(this).removeClass("bbit-dp-mp-sel"),$(this).html("<a href='javascript:void(0);'>"+r[e]+"</a>").attr("xyear",r[e])})}function p(e){var t=e.target||e.srcElement,n=m(t);return n==null?!1:(($(n).hasClass("bbit-dp-mp-month")||$(n).hasClass("bbit-dp-mp-year"))&&f(e),!1)}function d(e){var n=$(this),r=e.target||e.srcElement,i=m(r);if(i==null)return!1;if($(i).hasClass("bbit-dp-mp-month")&&!$(i).hasClass("bbit-dp-mp-sel")){var s=n.find("td.bbit-dp-mp-month.bbit-dp-mp-sel");s.length>0&&s.removeClass("bbit-dp-mp-sel"),$(i).addClass("bbit-dp-mp-sel"),t.cm=parseInt($(i).attr("xmonth"))}if($(i).hasClass("bbit-dp-mp-year")&&!$(i).hasClass("bbit-dp-mp-sel")){var s=n.find("td.bbit-dp-mp-year.bbit-dp-mp-sel");s.length>0&&s.removeClass("bbit-dp-mp-sel"),$(i).addClass("bbit-dp-mp-sel"),t.cy=parseInt($(i).attr("xyear"))}return!1}function v(){var e=$("#BBIT-DP-MP"),n=t.Year;t.cy=t.ty=n;var r=t.Month-1;t.cm=r;var i=$("#BBIT-DP-MP td.bbit-dp-mp-month");for(var s=i.length-1;s>=0;s--){var o=$(i[s]).attr("xmonth");o==r?$(i[s]).addClass("bbit-dp-mp-sel"):$(i[s]).removeClass("bbit-dp-mp-sel")}h(n),e.css("top",-193).show().animate({top:0},{duration:200})}function m(e){if(e.tagName.toUpperCase()=="TD")return e;if(e.tagName.toUpperCase()=="BODY")return null;var t=$(e).parent();return t.length>0?t[0].tagName.toUpperCase()!="TD"?m(t[0]):t[0]:null}function g(e){var t=e.target||e.srcElement,r=m(t);if(r==null)return!1;var i=$(r);if(!$(r).hasClass("bbit-dp-disabled")){var s=i.attr("xdate");n.data("indata",b(s)),x()}return!1}function y(){return!1}function b(e){try{var t=e.split(i18n.datepicker.dateformat.separator),n=parseInt(t[i18n.datepicker.dateformat.year_index]),r=parseInt(t[i18n.datepicker.dateformat.month_index])-1,i=parseInt(t[i18n.datepicker.dateformat.day_index]);return new Date(n,r,i)}catch(s){return null}}function w(){return t.Month==1?(t.Year--,t.Month=12):t.Month--,T(),!1}function E(){return t.Month==12?(t.Year++,t.Month=1):t.Month++,T(),!1}function S(){n.data("indata",new Date),x()}function x(){var e=n.data("ctarget"),t=n.data("cpk"),r=n.data("onReturn"),i=n.data("indata"),s=n.data("ads"),o=n.data("ade"),u=!1;s&&i<s&&(u=!0),o&&i>o&&(u=!0);if(u)return;r&&jQuery.isFunction(r)?r.call(e[0],n.data("indata")):e.val(dateFormat.call(n.data("indata"),i18n.datepicker.dateformat.fulldayvalue)),t.attr("isshow","0"),n.removeData("ctarget").removeData("cpk").removeData("indata").removeData("onReturn").removeData("ads").removeData("ade"),n.css("visibility","hidden"),e=t=null}function T(){var e=$("#BBIT_DP_INNER tbody");$("#BBIT_DP_YMBTN").html(t.monthName[t.Month-1]+t.monthp+" "+t.Year);var r=new Date(t.Year,t.Month-1,1),i=t.weekStart-r.getDay(),s=t.Month-1;i>0&&(i-=7);var o=DateAdd("d",i,r),u=DateAdd("d",42,o),a=n.data("ads"),f=n.data("ade"),l=[],c=dateFormat.call(t.today,i18n.datepicker.dateformat.fulldayvalue),h=n.data("indata"),p=h!=null?dateFormat.call(h,i18n.datepicker.dateformat.fulldayvalue):"";for(var d=1;d<=42;d++){d%7==1&&l.push("<tr>");var v=DateAdd("d",d-1,o),m=[],g=!1;a&&v<a&&(g=!0),f&&v>f&&(g=!0),v.getMonth()<s?m.push("bbit-dp-prevday"):v.getMonth()>s&&m.push("bbit-dp-nextday"),g?m.push("bbit-dp-disabled"):m.push("bbit-dp-active");var y=dateFormat.call(v,i18n.datepicker.dateformat.fulldayvalue);y==c&&m.push("bbit-dp-today"),y==p&&m.push("bbit-dp-selected"),l.push("<td class='",m.join(" "),"' title='",dateFormat.call(v,i18n.datepicker.dateformat.fulldayvalue),"' xdate='",dateFormat.call(v,i18n.datepicker.dateformat.fulldayvalue),"'><a href='javascript:void(0);'><em><span>",v.getDate(),"</span></em></a></td>"),d%7==0&&l.push("</tr>")}e.html(l.join(""))}var t={weekStart:0,weekName:[i18n.datepicker.dateformat.sun,i18n.datepicker.dateformat.mon,i18n.datepicker.dateformat.tue,i18n.datepicker.dateformat.wed,i18n.datepicker.dateformat.thu,i18n.datepicker.dateformat.fri,i18n.datepicker.dateformat.sat],monthName:[i18n.datepicker.dateformat.jan,i18n.datepicker.dateformat.feb,i18n.datepicker.dateformat.mar,i18n.datepicker.dateformat.apr,i18n.datepicker.dateformat.may,i18n.datepicker.dateformat.jun,i18n.datepicker.dateformat.jul,i18n.datepicker.dateformat.aug,i18n.datepicker.dateformat.sep,i18n.datepicker.dateformat.oct,i18n.datepicker.dateformat.nov,i18n.datepicker.dateformat.dec],monthp:i18n.datepicker.dateformat.postfix,Year:(new Date).getFullYear(),Month:(new Date).getMonth()+1,Day:(new Date).getDate(),today:new Date,btnOk:i18n.datepicker.ok,btnCancel:i18n.datepicker.cancel,btnToday:i18n.datepicker.today,inputDate:null,onReturn:!1,version:"1.1",applyrule:!1,showtarget:null,picker:""};$.extend(t,e);var n=$("#BBIT_DP_CONTAINER");if(n.length==0){var r=[];r.push("<div id='BBIT_DP_CONTAINER' class='bbit-dp' style='width:175px;z-index:999;'>"),$.browser.msie6&&r.push('<iframe style="position:absolute;z-index:-1;width:100%;height:205px;top:0;left:0;scrolling:no;" frameborder="0" src="about:blank"></iframe>'),r.push("<table class='dp-maintable' cellspacing='0' cellpadding='0' style='width:175px;'><tbody><tr><td>"),r.push("<table class='bbit-dp-top' cellspacing='0' style='padding:0;'><tr><td class='bbit-dp-top-left'> <a id='BBIT_DP_LEFTBTN' href='javascript:void(0);' title='",i18n.datepicker.prev_month_title,"'>&nbsp;</a></td><td class='bbit-dp-top-center' align='center'><em><button id='BBIT_DP_YMBTN'></button></em></td><td class='bbit-dp-top-right'><a id='BBIT_DP_RIGHTBTN' href='javascript:void(0);' title='",i18n.datepicker.next_month_title,"'>&nbsp;</a></td></tr></table>"),r.push("</td></tr>"),r.push("<tr><td>"),r.push("<table id='BBIT_DP_INNER' class='bbit-dp-inner' cellspacing='0' style='margin-bottom:0;'><thead><tr>");for(var i=t.weekStart,s=0;s<7;s++)r.push("<th><span>",t.weekName[i],"</span></th>"),i==6?i=0:i++;r.push("</tr></thead>"),r.push("<tbody></tbody></table>"),r.push("</td></tr>"),r.push("<tr><td class='bbit-dp-bottom' align='center'><button id='BBIT-DP-TODAY' style='background:none;'>",t.btnToday,"</button></td></tr>"),r.push("</tbody></table>"),r.push("<div id='BBIT-DP-MP' class='bbit-dp-mp'  style='z-index:auto;'><table id='BBIT-DP-T' style='width: 175px; height: 193px' border='0' cellspacing='0'><tbody>"),r.push("<tr>"),r.push("<td class='bbit-dp-mp-month' xmonth='0'><a href='javascript:void(0);'>",t.monthName[0],"</a></td><td class='bbit-dp-mp-month bbit-dp-mp-sep' xmonth='6'><a href='javascript:void(0);'>",t.monthName[6],"</a></td><td class='bbit-dp-mp-ybtn' align='middle'><a id='BBIT-DP-MP-PREV' class='bbit-dp-mp-prev'></a></td><td class='bbit-dp-mp-ybtn' align='middle'><a id='BBIT-DP-MP-NEXT' class='bbit-dp-mp-next'></a></td>"),r.push("</tr>"),r.push("<tr>"),r.push("<td class='bbit-dp-mp-month' xmonth='1'><a href='javascript:void(0);'>",t.monthName[1],"</a></td><td class='bbit-dp-mp-month bbit-dp-mp-sep' xmonth='7'><a href='javascript:void(0);'>",t.monthName[7],"</a></td><td class='bbit-dp-mp-year'><a href='javascript:void(0);'></a></td><td class='bbit-dp-mp-year'><a href='javascript:void(0);'></a></td>"),r.push("</tr>"),r.push("<tr>"),r.push("<td class='bbit-dp-mp-month' xmonth='2'><a href='javascript:void(0);'>",t.monthName[2],"</a></td><td class='bbit-dp-mp-month bbit-dp-mp-sep' xmonth='8'><a href='javascript:void(0);'>",t.monthName[8],"</a></td><td class='bbit-dp-mp-year'><a href='javascript:void(0);'></a></td><td class='bbit-dp-mp-year'><a href='javascript:void(0);'></a></td>"),r.push("</tr>"),r.push("<tr>"),r.push("<td class='bbit-dp-mp-month' xmonth='3'><a href='javascript:void(0);'>",t.monthName[3],"</a></td><td class='bbit-dp-mp-month bbit-dp-mp-sep' xmonth='9'><a href='javascript:void(0);'>",t.monthName[9],"</a></td><td class='bbit-dp-mp-year'><a href='javascript:void(0);'></a></td><td class='bbit-dp-mp-year'><a href='javascript:void(0);'></a></td>"),r.push("</tr>"),r.push("<tr>"),r.push("<td class='bbit-dp-mp-month' xmonth='4'><a href='javascript:void(0);'>",t.monthName[4],"</a></td><td class='bbit-dp-mp-month bbit-dp-mp-sep' xmonth='10'><a href='javascript:void(0);'>",t.monthName[10],"</a></td><td class='bbit-dp-mp-year'><a href='javascript:void(0);'></a></td><td class='bbit-dp-mp-year'><a href='javascript:void(0);'></a></td>"),r.push("</tr>"),r.push("<tr>"),r.push("<td class='bbit-dp-mp-month' xmonth='5'><a href='javascript:void(0);'>",t.monthName[5],"</a></td><td class='bbit-dp-mp-month bbit-dp-mp-sep' xmonth='11'><a href='javascript:void(0);'>",t.monthName[11],"</a></td><td class='bbit-dp-mp-year'><a href='javascript:void(0);'></a></td><td class='bbit-dp-mp-year'><a href='javascript:void(0);'></a></td>"),r.push("</tr>"),r.push("<tr class='bbit-dp-mp-btns'>"),r.push("<td colspan='4'><button id='BBIT-DP-MP-OKBTN' class='bbit-dp-mp-ok'>",t.btnOk,"</button><button id='BBIT-DP-MP-CANCELBTN' class='bbit-dp-mp-cancel'>",t.btnCancel,"</button></td>"),r.push("</tr>"),r.push("</tbody></table>"),r.push("</div>"),r.push("</div>");var o=r.join("");$(document.body).append(o),n=$("#BBIT_DP_CONTAINER"),u()}return $(this).each(function(){var e=$(this).addClass("bbit-dp-input"),r=$(t.picker);t.showtarget==null&&e.after(r),r.click(function(r){var i=$(this).attr("isshow"),s=$(this);n.css("visibility")=="visible"&&n.css(" visibility","hidden");if(i=="1")return s.attr("isshow","0"),n.removeData("ctarget").removeData("cpk").removeData("indata").removeData("onReturn"),!1;var o=e.val();o!=""&&(o=b(o)),o==null||o==""?(t.Year=(new Date).getFullYear(),t.Month=(new Date).getMonth()+1,t.Day=(new Date).getDate(),t.inputDate=null):(t.Year=o.getFullYear(),t.Month=o.getMonth()+1,t.Day=o.getDate(),t.inputDate=o),n.data("ctarget",e).data("cpk",s).data("indata",t.inputDate).data("onReturn",t.onReturn);if(t.applyrule&&$.isFunction(t.applyrule)){var u=t.applyrule.call(e,e[0].id);u&&(u.startdate?n.data("ads",u.startdate):n.removeData("ads"),u.enddate?n.data("ade",u.enddate):n.removeData("ade"))}else n.removeData("ads").removeData("ade");T(),$("#BBIT-DP-T").height(n.height());var a=t.showtarget||e,f=a.offset(),l=a.outerHeight(),c={left:f.left,top:f.top+l},h=n.width(),p=n.height(),d=document.documentElement.clientWidth,v=document.documentElement.clientHeight;return c.left+h>=d&&(c.left=d-h-2),c.top+p>=v&&(c.top=f.top-p-2),c.left<0&&(c.left=10),c.top<0&&(c.top=10),$("#BBIT-DP-MP").hide(),c.visibility="visible",n.css(c),$(this).attr("isshow","1"),$(document).one("click",function(e){s.attr("isshow","0"),n.removeData("ctarget").removeData("cpk").removeData("indata"),n.css("visibility","hidden")}),!1})})}})(jQuery);