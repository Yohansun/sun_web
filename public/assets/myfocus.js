/*
* myFocus JavaScript Library v1.2.4
* Open source under the BSD & GPL License.
* 
* @Author  koen_lee@qq.com
* @Blog    http://hi.baidu.com/koen_li/
* 
* @Date    2011/07/20
*/
(function(){var mF={defConfig:{pattern:"mF_fscreen_tb",trigger:"click",txtHeight:"default",wrap:!0,auto:!0,time:4,index:0,waiting:20,delay:100,css:!0,path:"/pattern/",autoZoom:!1},pattern:{},extend:function(){var a=arguments,b=a.length,c=1,d=a[0];b===1&&(c=0,d=this.pattern);for(c;c<b;c++)for(var e in a[c])e in d||(d[e]=a[c][e])}},DOM={$:function(a){return typeof a=="string"?document.getElementById(a):a},$$:function(a,b){return(this.$(b)||document).getElementsByTagName(a)},$$_:function(a,b){var c=[],d=this.$$(a,b);for(var e=0;e<d.length;e++)d[e].parentNode===b&&c.push(d[e]),e+=this.$$(a,d[e]).length;return c},$c:function(a,b){var c=this.$$("*",b),a=a.replace(/\-/g,"\\-"),d=new RegExp("(^|\\s)"+a+"(\\s|$)"),e=[];for(var f=0,g=c.length;f<g;f++)if(d.test(c[f].className)){e.push(c[f]);break}return e[0]},$li:function(a,b){return this.$$_("li",this.$c(a,b))},wrap:function(a,b){var c=document.createElement("div");c.className=b,a[0].parentNode.insertBefore(c,a[0]);for(var d=0;d<a.length;d++)c.appendChild(a[d])},wrapIn:function(a,b){a.innerHTML="<ul class="+b+">"+a.innerHTML+"</ul>"},addList:function(a,b){var c=[],d=this.$$("ul",a)[0],e=this.$$_("li",d),f,g=e.length,h=b.length;for(var i=0;i<h;i++){c.push("<ul class="+b[i]+">");for(var j=0;j<g;j++)f=this.$$("img",e[j])[0],c.push("<li>"+(b[i]=="num"?"<a>"+(j+1)+"</a>":b[i]=="txt"&&f?e[j].innerHTML.replace(/\<img(.|\n|\r)*?\>/i,f.alt)+"<p>"+f.getAttribute("text")+"</p>":b[i]=="thumb"&&f?"<img src="+(f.getAttribute("thumb")||f.src)+" />":"")+"<span></span></li>");c.push("</ul>")}a.innerHTML+=c.join("")}},CSS={style:function(a,b){var c=(this.isIE?a.currentStyle:getComputedStyle(a,""))[b],d=parseFloat(c);return isNaN(d)?c:d},setOpa:function(a,b){a.style.filter="alpha(opacity="+b+")",a.style.opacity=b/100},removeClass:function(o,name){var cla=o.className,reg="/\\s*"+name+"\\b/g";o.className=cla?cla.replace(eval(reg),""):""}},Anim={animate:function(a,b,c,d,e,f){var g=b==="opacity",h=this,i=h.setOpa,j=typeof c=="string",k=(new Date).getTime();g&&h.style(a,"display")==="none"&&(a.style.display="block",i(a,0));var l=h.style(a,b),m=isNaN(l)?1:l,n=j?c/1:c-m,o=d||800,p=h.easing[e||"easeOut"],q=n>0?"ceil":"floor";return a[b+"Timer"]&&clearInterval(a[b+"Timer"]),a[b+"Timer"]=setInterval(function(){var d=(new Date).getTime()-k;d<o?g?i(a,Math[q](p(d,m*100,n*100,o))):a.style[b]=Math[q](p(d,m,n,o))+"px":(clearInterval(a[b+"Timer"]),g?i(a,(n+m)*100):a.style[b]=n+m+"px",g&&c===0&&(a.style.display="none"),f&&f.call(a))},13),h},fadeIn:function(a,b,c){return this.animate(a,"opacity",1,b==undefined?400:b,"linear",c),this},fadeOut:function(a,b,c){return this.animate(a,"opacity",0,b==undefined?400:b,"linear",c),this},slide:function(a,b,c,d,e){for(var f in b)this.animate(a,f,b[f],c,d,e);return this},stop:function(a){for(var b in a)b.indexOf("Timer")!==-1&&clearInterval(a[b]);return this},easing:{linear:function(a,b,c,d){return c*a/d+b},swing:function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b},easeIn:function(a,b,c,d){return c*(a/=d)*a*a*a+b},easeOut:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},easeInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b}}},Init={set:function(a,b,c){function f(){e==2&&(a.autoZoom&&d.fixIMG(a.id,a.width,a.height),d.pattern[a.pattern].call(d,a,d),c&&c())}function g(){var b=d.$(a.id);b.style.height="314px",d.loadPattern(a.pattern,a.path,function(){d.extend(a,d.pattern[a.pattern].cfg,d.defConfig),a.width=a.width||d.style(b,"width"),a.height=a.height||d.style(b,"height"),d.initCSS(a),b.className+=" "+a.pattern+" "+a.S,b.style.height="",e+=1,f()}),d.onloadIMG(b,a.waiting==undefined?d.defConfig.waiting:a.waiting,function(){e+=1,f()})}typeof b!="boolean"&&(c=b,b=!1);var d=this,e=0;a.pattern=a.pattern||d.defConfig.pattern,a.path=a.path==undefined?d.defConfig.path:a.path,a.S=a.pattern+"-"+a.id;if(b){g();return}window.attachEvent?function(){try{g()}catch(a){setTimeout(arguments.callee,0)}}():d.addEvent(document,"DOMContentLoaded",g)},initCSS:function(a){var b=[],c=a.width,d=a.height,e=document.createElement("style");e.type="text/css",a.wrap&&this.wrap([this.$(a.id)],a.pattern+"_wrap"),a.css&&b.push("."+a.S+" *{margin:0;padding:0;border:0;list-style:none;}."+a.S+"{position:relative;width:"+c+"px;height:"+d+"px;overflow:hidden;font:12px/1.5 Verdana;text-align:left;background:#fff;visibility:visible!important;}."+a.S+" .loading{position:absolute;z-index:9999;width:100%;height:100%;color:#666;text-align:center;padding-top:"+.3*d+"px;background:#fff url(http://www.cosmissy.com/myfocus/img/loading.gif) center "+.4*d+"px no-repeat;}."+a.S+" .pic{position:relative;width:"+c+"px;height:"+d+"px;overflow:hidden;}."+a.S+" .txt li,."+a.S+" .txt li span,."+a.S+" .txt-bg{width:"+c+"px;height:"+a.txtHeight+"px!important;line-height:"+a.txtHeight+"px!important;overflow:hidden;}."+a.S+" .txt li p a{display:inline;}"),a.css&&a.autoZoom&&b.push("."+a.S+" .pic li{text-align:center;width:"+c+"px;height:"+d+"px;}"),e.styleSheet?e.styleSheet.cssText=b.join(""):e.innerHTML=b.join("");var f=this.$$("head",document)[0];f.insertBefore(e,f.firstChild)}},Method={isIE:!+[1],switchMF:function(a,b,c,d,e){return"var _F=this,_ld=_F.$c('loading',box),less="+c+",_tn,first=true,_dir="+d+"||'left',_dis=_dir=='left'||_dir=='right'?par.width:par.height,_wp=less&&("+e+"||pics),index=par.index,_t=par.time*1000;if(less){_wp.style[_dir]=-_dis*n+'px';index+=n;}if(_ld)box.removeChild(_ld);var run=function(idx){("+a+")();var prev=index;if(less&&index==2*n-1&&_tn!=1){_wp.style[_dir]=-(n-1)*_dis+'px';index=n-1}if(less&&index==0&&_tn!=2){_wp.style[_dir]=-n*_dis+'px';index=n}if(!less&&index==n-1&&idx==undefined)index=-1;if(less&&idx!==undefined&&index>n-1&&!_tn&&!first) idx+=n;var next=idx!==undefined?idx:index+1;if("+b+")("+b+")();index=next;_tn=first=null;};run(index);if(_t&&par.auto)var auto=setInterval(function(){run()},_t);_F.addEvent(box,'mouseover',function(){if(auto)clearInterval(auto)});_F.addEvent(box,'mouseout',function(){if(auto)auto=setInterval(function(){run()},_t)});for(var i=0,_lk=_F.$$('a',box),_ln=_lk.length;i<_ln;i++) _lk[i].onfocus=function(){this.blur();}"},bind:function(a,b,c){return"for (var j=0;j<n;j++){"+a+"[j].index=j;if("+b+"=='click'){"+a+"[j].onmouseover=function(){if(this.index!=index)this.className+=' hover'};"+a+"[j].onmouseout=function(){_F.removeClass(this,'hover')};"+a+"[j].onclick=function(){if(this.index!=index) {run(this.index);return false}};}else if("+b+"=='mouseover'){"+a+"[j].onmouseover=function(){var self=this;if("+c+"==0){if(self.index!=index){run(self.index);return false}}else "+a+".d=setTimeout(function(){if(self.index!=index) {run(self.index);return false}},"+c+")};"+a+"[j].onmouseout=function(){clearTimeout("+a+".d)};}else{alert('Error Setting : \"'+"+b+"+'\"');break;}}"},toggle:function(a,b,c){return"var _stop=false;"+a+".onclick=function(){this.className=this.className=='"+b+"'?'"+c+"':'"+b+"';if(!_stop){clearInterval(auto);auto=null;_stop=true;}else{auto=true;_stop=false;}}"},scroll:function(a,b,c,d,e){return"var scPar={},scDis="+c+",scN=Math.floor("+d+"/2),scDir=parseInt("+a+".style["+b+"])||0,scIdx=next>=n?next-n:next,scDur="+e+"||500,scMax=scDis*(n-"+d+"),scD=scDis*scIdx+scDir;if(scD>scDis*scN&&scIdx!==n-1) scPar["+b+"]='-'+scDis;if(scD<scDis&&scIdx!==0) scPar["+b+"]='+'+scDis;if(scIdx===n-1) scPar["+b+"]=-scMax;if(scIdx===0) scPar["+b+"]=0;_F.slide("+a+",scPar,scDur);"},turn:function(a,b){return a+".onclick=function(){_tn=1;run(index>0?index-1:n-1);};"+b+".onclick=function(){_tn=2;var tIdx=index>=2*n-1?n-1:index;run(index==n-1&&!less?0:tIdx+1);}"},alterSRC:function(o,name,del){var img=this.$$("img",o)[0];img.src=del?img.src.replace(eval("/"+name+"\\.(?=[^\\.]+$)/g"),"."):img.src.replace(/\.(?=[^\.]+$)/g,name+".")},onloadIMG:function(a,b,c){var d=this.$$("img",a),e=d.length,f=0,g=!1;for(var h=0;h<e;h++)d[h].onload=function(){f+=1,f==e&&!g&&(g=!0,c())},this.isIE&&(d[h].src=d[h].src);if(b===!0)return;var i=b===!1?0:b*1e3;setTimeout(function(){g||(g=!0,c())},i)},fixIMG:function(a,b,c){var d=this.$$("img",a),e=d.length,f=new Image;for(var g=0;g<e;g++)f.src=d[g].src,f.width/f.height>=b/c?(d[g].style.width=b+"px",d[g].style.marginTop=(c-b/f.width*f.height)/2+"px"):d[g].style.height=c+"px"},loadPattern:function(a,b,c){if(!b){c();return}var d=document.createElement("script"),e=document.createElement("link"),f=b+a+".js",g=b+a+".css";d.type="text/javascript",d.src=f,e.rel="stylesheet",e.href=g,this.$$("head")[0].appendChild(e),this.$$("head")[0].appendChild(d),this.isIE?d.onreadystatechange=function(){(d.readyState=="loaded"||d.readyState=="complete")&&c()}:d.onload=function(){c()},d.onerror=function(){alert("Not Found (404): "+f)}},addEvent:function(a,b,c){var d=this.isIE,e=d?"attachEvent":"addEventListener",f=(d?"on":"")+b;a[e](f,c,!1)}};mF.extend(mF,DOM,CSS,Anim,Init,Method),mF.set.params=function(a,b){mF.pattern[a].cfg=b},myFocus__AGENT__=mF,typeof myFocus=="undefined"&&(myFocus=myFocus__AGENT__),typeof jQuery!="undefined"&&jQuery.fn.extend({myFocus:function(a,b){a||(a={}),a.id=this[0].id,a.id||(a.id=this[0].id="mF__NAME__"),myFocus__AGENT__.set(a,!0,b)}})})();