/**
 * jQuery多级联动菜单
 *
 * Author:	ZhouFan <happyeddie@gmail.com>
 *
 */
function LinkageSelect(a){function e(a,h,i){var j=b.length?b[b.length-1].key+","+b[b.length-1].value:d.root;b.push({element:a,key:j,value:h});var k=0;for(var l in c)k++;for(var m in b)if(b[m].element==a)var n=parseInt(m);for(var m in b)m<n&&b[m].element.change(function(){f(a,undefined,undefined,i)});n>0&&b[n-1].element.change(function(){f(a,b[n].key,undefined,i)}),a.change(function(){var c=b[n-1]?b[n].key+","+$(this).val():"0,"+$(this).val();typeof b[n+1]!="undefined"&&(b[n+1].key=c),d.field_name&&$(d.field_name).val($(this).val()),d.auto&&typeof b[n+1]=="undefined"&&g(c,function(c,d){if(d){var g=$("<select></select>");a.after(g),e(g,""),f(b[n+1].element,c,d,i)}})}),f(a,j,h,i)}function f(a,b,c,e){a.empty(),a.append('<option value="">'+e+"</option>");var h=g(b,function(){f(a,b,c)});if(!h)return d.auto&&a.hide(),!1;a.show();var i=1,j=0;for(var k in h){var l=h[k],m="";k==c&&(j=i,m='selected="selected"');var n=$('<option value="'+k+'" '+m+">"+l+"</option>");a.append(n),i++}a[0]&&(setTimeout(function(){a[0].options[j].selected=!0},0),a[0].selectedIndex=0,a.attr("selectedIndex",j)),a.width(a.width())}function g(a,b){if(typeof a=="undefined")return null;if(a[a.length-1]==",")return null;if(typeof c[a]=="undefined"){var e=0;for(var f in c){e++;break}d.ajax?$.getJSON(d.ajax,{key:a},function(d){c[a]=d,b(a,d)}):d.file&&e==0&&$.getJSON(d.file,function(d){c=d,b(a,d)})}return c[a]}function h(a){return typeof a=="string"?$(a):a}var b=new Array,c={},d={data:{},file:null,root:"0",ajax:null,timeout:30,method:"post",field_name:null,auto:!1};return a&&jQuery.extend(d,a),c=d.data,{bind:function(a,b,c){typeof c=="undefined"&&(c="请选择"),typeof a!="object"&&(a=h(a)),b=b?b:"",e(a,b,c)}}};