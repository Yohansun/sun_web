function ImageFlow(){this.defaults={animationSpeed:50,aspectRatio:2.5,buttons:!1,captions:0,circular:!1,imageCursor:"default",ImageFlowID:"imageflow",imageFocusM:1,imageFocusMax:2,imagePath:"",imageScaling:!0,imagesHeight:.67,imagesM:.5,onClick:function(){},opacity:!0,opacityArray:[10,3,1,1,1],percentLandscape:100,percentOther:100,preloadImages:!0,reflections:0,reflectionGET:"",reflectionP:.5,reflectionPNG:!1,reflectPath:"",scrollbarP:.6,slider:0,sliderCursor:"e-resize",sliderWidth:14,slideshow:!1,slideshowSpeed:1500,slideshowAutoplay:!1,startID:1,glideToStartID:!0,startAnimation:!1,xStep:80};var e=this;this.init=function(t){for(var n in e.defaults)this[n]=t!==undefined&&t[n]!==undefined?t[n]:e.defaults[n];var r=document.getElementById(e.ImageFlowID);if(r){r.style.visibility="visible",this.ImageFlowDiv=r;if(this.createStructure()){this.imagesDiv=document.getElementById(e.ImageFlowID+"_images"),this.captionDiv=document.getElementById(e.ImageFlowID+"_caption"),this.navigationDiv=document.getElementById(e.ImageFlowID+"_navigation"),this.scrollbarDiv=document.getElementById(e.ImageFlowID+"_scrollbar"),this.sliderDiv=document.getElementById(e.ImageFlowID+"_slider"),this.buttonNextDiv=document.getElementById(e.ImageFlowID+"_next"),this.buttonPreviousDiv=document.getElementById(e.ImageFlowID+"_previous"),this.buttonSlideshow=document.getElementById(e.ImageFlowID+"_slideshow"),this.indexArray=[],this.current=0,this.imageID=0,this.target=0,this.memTarget=0,this.firstRefresh=!0,this.firstCheck=!0,this.busy=!1;var i=this.ImageFlowDiv.offsetWidth,s=Math.round(i/e.aspectRatio);document.getElementById(e.ImageFlowID+"_loading_txt").style.paddingTop=s*.5-22+"px",r.style.height=s+"px",this.loadingProgress()}}},this.createStructure=function(){var t=e.Helper.createDocumentElement("div","images"),n,r,i,s,o=e.ImageFlowDiv.childNodes.length;for(var u=0;u<o;u++)n=e.ImageFlowDiv.childNodes[u],n&&n.nodeType==1&&n.nodeName=="IMG"&&(e.reflections===!0&&(r=e.reflectionPNG?"3":"2",i=e.imagePath+n.getAttribute("src",2),i=e.reflectPath+"reflect"+r+".php?img="+i+e.reflectionGET,n.setAttribute("src",i)),s=n.cloneNode(!0),t.appendChild(s));if(e.circular){var a=e.Helper.createDocumentElement("div","images"),f=e.Helper.createDocumentElement("div","images");o=t.childNodes.length,o<e.imageFocusMax&&(e.imageFocusMax=o);if(o>1){var l;for(l=0;l<o;l++)n=t.childNodes[l],l<e.imageFocusMax&&(s=n.cloneNode(!0),a.appendChild(s)),o-l<e.imageFocusMax+1&&(s=n.cloneNode(!0),f.appendChild(s));for(l=0;l<o;l++)n=t.childNodes[l],s=n.cloneNode(!0),f.appendChild(s);for(l=0;l<e.imageFocusMax;l++)n=a.childNodes[l],s=n.cloneNode(!0),f.appendChild(s);t=f}}if(e.slideshow){var c=e.Helper.createDocumentElement("div","slideshow");t.appendChild(c)}var h=e.Helper.createDocumentElement("p","loading_txt"),p=document.createTextNode(" ");h.appendChild(p);var d=e.Helper.createDocumentElement("div","loading"),v=e.Helper.createDocumentElement("div","loading_bar");d.appendChild(v);var m=e.Helper.createDocumentElement("div","caption"),g=e.Helper.createDocumentElement("div","scrollbar"),y=e.Helper.createDocumentElement("div","slider");g.appendChild(y);if(e.buttons){var b=e.Helper.createDocumentElement("div","previous","button"),w=e.Helper.createDocumentElement("div","next","button");g.appendChild(b),g.appendChild(w)}var E=e.Helper.createDocumentElement("div","navigation");E.appendChild(m),E.appendChild(g);var S=!1;if(e.ImageFlowDiv.appendChild(t)&&e.ImageFlowDiv.appendChild(h)&&e.ImageFlowDiv.appendChild(d)&&e.ImageFlowDiv.appendChild(E)){o=e.ImageFlowDiv.childNodes.length;for(u=0;u<o;u++)n=e.ImageFlowDiv.childNodes[u],n&&n.nodeType==1&&n.nodeName=="IMG"&&e.ImageFlowDiv.removeChild(n);S=!0}return S},this.loadingProgress=function(){var t=e.loadingStatus();(t<100||e.firstCheck)&&e.preloadImages?e.firstCheck&&t==100?(e.firstCheck=!1,window.setTimeout(e.loadingProgress,100)):window.setTimeout(e.loadingProgress,40):(document.getElementById(e.ImageFlowID+"_loading_txt").style.display="none",document.getElementById(e.ImageFlowID+"_loading").style.display="none",window.setTimeout(e.Helper.addResizeEvent,1e3),e.refresh(),e.max>1&&(e.MouseWheel.init(),e.MouseDrag.init(),e.Touch.init(),e.Key.init(),e.slideshow&&e.Slideshow.init(),e.slider&&(e.scrollbarDiv.style.visibility="visible")))},this.loadingStatus=function(){var t=e.imagesDiv.childNodes.length,n=0,r=0,i=null;for(var s=0;s<t;s++)i=e.imagesDiv.childNodes[s],i&&i.nodeType==1&&i.nodeName=="IMG"&&(i.complete&&r++,n++);var o=Math.round(r/n*100),u=document.getElementById(e.ImageFlowID+"_loading_bar");u.style.width=o+"%",e.circular&&(n-=e.imageFocusMax*2,r=o<1?0:Math.round(n/100*o));var a=document.getElementById(e.ImageFlowID+"_loading_txt"),f=document.createTextNode("loading images "+r+"/"+n);return a.replaceChild(f,a.firstChild),o},this.refresh=function(){this.imagesDivWidth=e.imagesDiv.offsetWidth+e.imagesDiv.offsetLeft,this.maxHeight=Math.round(e.imagesDivWidth/e.aspectRatio),this.maxFocus=e.imageFocusMax*e.xStep,this.size=e.imagesDivWidth*.5,this.sliderWidth=e.sliderWidth*.5,this.scrollbarWidth=(e.imagesDivWidth-Math.round(e.sliderWidth)*2)*e.scrollbarP,this.imagesDivHeight=Math.round(e.maxHeight*e.imagesHeight),e.ImageFlowDiv.style.height=e.maxHeight+"px",e.imagesDiv.style.height=e.imagesDivHeight+"px",e.navigationDiv.style.height=e.maxHeight-e.imagesDivHeight+"px",e.captionDiv.style.width=e.imagesDivWidth+"px",e.captionDiv.style.paddingTop=Math.round(e.imagesDivWidth*.02)+"px",e.scrollbarDiv.style.width=e.scrollbarWidth+"px",e.scrollbarDiv.style.marginTop=Math.round(e.imagesDivWidth*.02)+"px",e.scrollbarDiv.style.marginLeft=Math.round(e.sliderWidth+(e.imagesDivWidth-e.scrollbarWidth)/2)+"px",e.sliderDiv.style.cursor=e.sliderCursor,e.sliderDiv.onmousedown=function(){return e.MouseDrag.start(this),!1},e.buttons&&(e.buttonPreviousDiv.onclick=function(){e.MouseWheel.handle(1)},e.buttonNextDiv.onclick=function(){e.MouseWheel.handle(-1)});var t=e.reflections===!0?e.reflectionP+1:1,n=e.imagesDiv.childNodes.length,r=0,i=null;for(var s=0;s<n;s++)i=e.imagesDiv.childNodes[s],i!==null&&i.nodeType==1&&i.nodeName=="IMG"&&(this.indexArray[r]=s,i.url=i.getAttribute("longdesc"),i.xPosition=-r*e.xStep,i.i=r,e.firstRefresh&&(i.getAttribute("width")!==null&&i.getAttribute("height")!==null?(i.w=i.getAttribute("width"),i.h=i.getAttribute("height")*t):(i.w=i.width,i.h=i.height)),i.w>i.h/(e.reflectionP+1)?(i.pc=e.percentLandscape,i.pcMem=e.percentLandscape):(i.pc=e.percentOther,i.pcMem=e.percentOther),e.imageScaling===!1&&(i.style.position="relative",i.style.display="inline"),i.style.cursor=e.imageCursor,r++);this.max=e.indexArray.length,e.imageScaling===!1&&(i=e.imagesDiv.childNodes[e.indexArray[0]],this.totalImagesWidth=i.w*e.max,i.style.paddingLeft=e.imagesDivWidth/2+i.w/2+"px",e.imagesDiv.style.height=i.h+"px",e.navigationDiv.style.height=e.maxHeight-i.h+"px"),e.firstRefresh&&(e.firstRefresh=!1,e.imageID=e.startID-1,e.imageID<0&&(e.imageID=0),e.circular&&(e.imageID=e.imageID+e.imageFocusMax),maxId=e.circular?e.max-e.imageFocusMax-1:e.max-1,e.imageID>maxId&&(e.imageID=maxId),e.glideToStartID===!1&&e.moveTo(-e.imageID*e.xStep),e.startAnimation&&e.moveTo(5e3)),e.max>1&&e.glideTo(e.imageID),e.moveTo(e.current)},this.moveTo=function(t){this.current=t,this.zIndex=e.max;for(var n=0;n<e.max;n++){var r=e.imagesDiv.childNodes[e.indexArray[n]],i=n*-e.xStep;if(e.imageScaling)if(i+e.maxFocus<e.memTarget||i-e.maxFocus>e.memTarget)r.style.visibility="hidden",r.style.display="none";else{var s=(Math.sqrt(1e4+t*t)+100)*e.imagesM,o=t/s*e.size+e.size;r.style.display="block";var u=r.h/r.w*r.pc/s*e.size,a=0;switch(u>e.maxHeight){case!1:a=r.pc/s*e.size;break;default:u=e.maxHeight,a=r.w*u/r.h}var f=e.imagesDivHeight-u+u/(e.reflectionP+1)*e.reflectionP;r.style.left=o-r.pc/2/s*e.size+"px",a&&u&&(r.style.height=u+"px",r.style.width=a+"px",r.style.top=f+"px"),r.style.visibility="visible";switch(t<0){case!0:this.zIndex++;break;default:this.zIndex=e.zIndex-1}switch(r.i==e.imageID){case!1:r.onclick=function(){e.glideTo(this.i)};break;default:this.zIndex=e.zIndex+1,r.url!==""&&(r.onclick=e.onClick)}r.style.zIndex=e.zIndex}else{if(i+e.maxFocus<e.memTarget||i-e.maxFocus>e.memTarget)r.style.visibility="hidden";else{r.style.visibility="visible";switch(r.i==e.imageID){case!1:r.onclick=function(){e.glideTo(this.i)};break;default:r.url!==""&&(r.onclick=e.onClick)}}e.imagesDiv.style.marginLeft=t-e.totalImagesWidth+"px"}t+=e.xStep}},this.glideTo=function(t){var n,r;e.circular&&(t+1===e.imageFocusMax&&(r=e.max-e.imageFocusMax,n=-r*e.xStep,t=r-1),t===e.max-e.imageFocusMax&&(r=e.imageFocusMax-1,n=-r*e.xStep,t=r+1));var i=-t*e.xStep;this.target=i,this.memTarget=i,this.imageID=t;var s=e.imagesDiv.childNodes[t].getAttribute("alt");if(s===""||e.captions===!1)s="&nbsp;";e.captionDiv.innerHTML=s,$(".art_kv_info").children("img").attr("src","/assets/paint_art/art_kv/"+s),e.MouseDrag.busy===!1&&(e.circular?this.newSliderX=(t-e.imageFocusMax)*e.scrollbarWidth/(e.max-e.imageFocusMax*2-1)-e.MouseDrag.newX:this.newSliderX=t*e.scrollbarWidth/(e.max-1)-e.MouseDrag.newX,e.sliderDiv.style.marginLeft=e.newSliderX-e.sliderWidth+"px");if(e.opacity===!0||e.imageFocusM!==e.defaults.imageFocusM){e.Helper.setOpacity(e.imagesDiv.childNodes[t],e.opacityArray[0]),e.imagesDiv.childNodes[t].pc=e.imagesDiv.childNodes[t].pc*e.imageFocusM;var o=0,u=0,a=0,f=e.opacityArray.length;for(var l=1;l<e.imageFocusMax+1;l++)l+1>f?o=e.opacityArray[f-1]:o=e.opacityArray[l],u=t+l,a=t-l,u<e.max&&(e.Helper.setOpacity(e.imagesDiv.childNodes[u],o),e.imagesDiv.childNodes[u].pc=e.imagesDiv.childNodes[u].pcMem),a>=0&&(e.Helper.setOpacity(e.imagesDiv.childNodes[a],o),e.imagesDiv.childNodes[a].pc=e.imagesDiv.childNodes[a].pcMem)}n&&e.moveTo(n),e.busy===!1&&(e.busy=!0,e.animate())},this.animate=function(){switch(e.target<e.current-1||e.target>e.current+1){case!0:e.moveTo(e.current+(e.target-e.current)/3),window.setTimeout(e.animate,e.animationSpeed),e.busy=!0;break;default:e.busy=!1}},this.glideOnEvent=function(t){e.slideshow&&e.Slideshow.interrupt(),e.glideTo(t)},this.Slideshow={direction:1,init:function(){e.slideshowAutoplay?e.Slideshow.start():e.Slideshow.stop()},interrupt:function(){e.Helper.removeEvent(e.ImageFlowDiv,"click",e.Slideshow.interrupt),e.Slideshow.stop()},addInterruptEvent:function(){e.Helper.addEvent(e.ImageFlowDiv,"click",e.Slideshow.interrupt)},start:function(){e.Helper.setClassName(e.buttonSlideshow,"slideshow pause"),e.buttonSlideshow.onclick=function(){e.Slideshow.stop()},e.Slideshow.action=window.setInterval(e.Slideshow.slide,e.slideshowSpeed),window.setTimeout(e.Slideshow.addInterruptEvent,100)},stop:function(){e.Helper.setClassName(e.buttonSlideshow,"slideshow play"),e.buttonSlideshow.onclick=function(){e.Slideshow.start()},window.clearInterval(e.Slideshow.action)},slide:function(){var t=e.imageID+e.Slideshow.direction,n=!1;t===e.max&&(e.Slideshow.direction=-1,n=!0),t<0&&(e.Slideshow.direction=1,n=!0),n?e.Slideshow.slide():e.glideTo(t)}},this.MouseWheel={init:function(){window.addEventListener&&e.ImageFlowDiv.addEventListener("DOMMouseScroll",e.MouseWheel.get,!1),e.Helper.addEvent(e.ImageFlowDiv,"mousewheel",e.MouseWheel.get)},get:function(t){var n=0;t||(t=window.event),t.wheelDelta?n=t.wheelDelta/120:t.detail&&(n=-t.detail/3),n&&e.MouseWheel.handle(n),e.Helper.suppressBrowserDefault(t)},handle:function(t){var n=!1,r=0;t>0?e.imageID>=1&&(r=e.imageID-1,n=!0):e.imageID<e.max-1&&(r=e.imageID+1,n=!0),n&&e.glideOnEvent(r)}},this.MouseDrag={object:null,objectX:0,mouseX:0,newX:0,busy:!1,init:function(){e.Helper.addEvent(e.ImageFlowDiv,"mousemove",e.MouseDrag.drag),e.Helper.addEvent(e.ImageFlowDiv,"mouseup",e.MouseDrag.stop),e.Helper.addEvent(document,"mouseup",e.MouseDrag.stop),e.ImageFlowDiv.onselectstart=function(){var t=!0;return e.MouseDrag.busy&&(t=!1),t}},start:function(t){e.MouseDrag.object=t,e.MouseDrag.objectX=e.MouseDrag.mouseX-t.offsetLeft+e.newSliderX},stop:function(){e.MouseDrag.object=null,e.MouseDrag.busy=!1},drag:function(t){var n=0;t||(t=window.event),t.pageX?n=t.pageX:t.clientX&&(n=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft),e.MouseDrag.mouseX=n;if(e.MouseDrag.object!==null){var r=e.MouseDrag.mouseX-e.MouseDrag.objectX+e.sliderWidth;r<-e.newSliderX&&(r=-e.newSliderX),r>e.scrollbarWidth-e.newSliderX&&(r=e.scrollbarWidth-e.newSliderX);var i,s;e.circular?(i=(r+e.newSliderX)/(e.scrollbarWidth/(e.max-e.imageFocusMax*2-1)),s=Math.round(i)+e.imageFocusMax):(i=(r+e.newSliderX)/(e.scrollbarWidth/(e.max-1)),s=Math.round(i)),e.MouseDrag.newX=r,e.MouseDrag.object.style.left=r+"px",e.imageID!==s&&e.glideOnEvent(s),e.MouseDrag.busy=!0}}},this.Touch={x:0,startX:0,stopX:0,busy:!1,first:!0,init:function(){e.Helper.addEvent(e.navigationDiv,"touchstart",e.Touch.start),e.Helper.addEvent(document,"touchmove",e.Touch.handle),e.Helper.addEvent(document,"touchend",e.Touch.stop)},isOnNavigationDiv:function(t){var n=!1;if(t.touches){var r=t.touches[0].target;if(r===e.navigationDiv||r===e.sliderDiv||r===e.scrollbarDiv)n=!0}return n},getX:function(e){var t=0;return e.touches&&(t=e.touches[0].pageX),t},start:function(t){e.Touch.startX=e.Touch.getX(t),e.Touch.busy=!0,e.Helper.suppressBrowserDefault(t)},isBusy:function(){var t=!1;return e.Touch.busy&&(t=!0),t},handle:function(t){if(e.Touch.isBusy&&e.Touch.isOnNavigationDiv(t)){var n=e.circular?e.max-e.imageFocusMax*2-1:e.max-1;e.Touch.first&&(e.Touch.stopX=(n-e.imageID)*(e.imagesDivWidth/n),e.Touch.first=!1);var r=-(e.Touch.getX(t)-e.Touch.startX-e.Touch.stopX);r<0&&(r=0),r>e.imagesDivWidth&&(r=e.imagesDivWidth),e.Touch.x=r;var i=Math.round(r/(e.imagesDivWidth/n));i=n-i,e.imageID!==i&&(e.circular&&(i+=e.imageFocusMax),e.glideOnEvent(i)),e.Helper.suppressBrowserDefault(t)}},stop:function(){e.Touch.stopX=e.Touch.x,e.Touch.busy=!1}},this.Key={init:function(){document.onkeydown=function(t){e.Key.handle(t)}},handle:function(t){var n=e.Key.get(t);switch(n){case 39:e.MouseWheel.handle(-1);break;case 37:e.MouseWheel.handle(1)}},get:function(e){return e=e||window.event,e.keyCode}},this.Helper={addEvent:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&(e["e"+t+n]=n,e[t+n]=function(){e["e"+t+n](window.event)},e.attachEvent("on"+t,e[t+n]))},removeEvent:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&(e[t+n]===undefined&&alert("Helper.removeEvent » Pointer to detach event is undefined - perhaps you are trying to detach an unattached event?"),e.detachEvent("on"+t,e[t+n]),e[t+n]=null,e["e"+t+n]=null)},setOpacity:function(t,n){e.opacity===!0&&(t.style.opacity=n/10,t.style.filter="alpha(opacity="+n*10+")")},createDocumentElement:function(t,n,r){var i=document.createElement(t);return i.setAttribute("id",e.ImageFlowID+"_"+n),r!==undefined&&(n+=" "+r),e.Helper.setClassName(i,n),i},setClassName:function(e,t){e&&(e.setAttribute("class",t),e.setAttribute("className",t))},suppressBrowserDefault:function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,!1},addResizeEvent:function(){var t=window.onresize;typeof window.onresize!="function"?window.onresize=function(){e.refresh()}:window.onresize=function(){t&&t(),e.refresh()}}}}var domReadyEvent={name:"domReadyEvent",events:{},domReadyID:1,bDone:!1,DOMContentLoadedCustom:null,add:function(e){e.$$domReadyID||(e.$$domReadyID=this.domReadyID++,this.bDone&&e(),this.events[e.$$domReadyID]=e)},remove:function(e){e.$$domReadyID&&delete this.events[e.$$domReadyID]},run:function(){if(this.bDone)return;this.bDone=!0;for(var e in this.events)this.events[e]()},schedule:function(){if(this.bDone)return;if(/KHTML|WebKit/i.test(navigator.userAgent))/loaded|complete/.test(document.readyState)?this.run():setTimeout(this.name+".schedule()",100);else if(document.getElementById("__ie_onload"))return!0;return typeof this.DOMContentLoadedCustom=="function"&&typeof document.getElementsByTagName!="undefined"&&(document.getElementsByTagName("body")[0]!==null||document.body!==null)&&(this.DOMContentLoadedCustom()?this.run():setTimeout(this.name+".schedule()",250)),!0},init:function(){function e(){domReadyEvent.run()}document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){domReadyEvent.run()},!1),setTimeout("domReadyEvent.schedule()",100);if(typeof addEvent!="undefined")addEvent(window,"load",e);else if(document.addEventListener)document.addEventListener("load",e,!1);else if(typeof window.onload=="function"){var t=window.onload;window.onload=function(){domReadyEvent.run(),t()}}else window.onload=e}},instanceOne,domReady=function(e){domReadyEvent.add(e)};domReadyEvent.init(),domReady(function(){instanceOne=new ImageFlow,instanceOne.init({ImageFlowID:"gallery"});var e=$("#gallery");e.parent().find("span.moveleft").click(function(){instanceOne.MouseWheel.handle(1)}),e.parent().find("span.moveright").click(function(){instanceOne.MouseWheel.handle(-1)})});